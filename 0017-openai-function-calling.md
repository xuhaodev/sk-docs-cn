
# OpenAI 函数调用支持

## 上下文和问题陈述

 [](https://platform.openai.com/docs/guides/gpt/function-calling) OpenAI 的 Chat Completions API 的函数调用功能允许开发人员向模型描述函数，并让模型决定是否输出一个 JSON 对象，指定一个函数和适当的参数来响应给定的提示。此功能由终端节点的两个新 API 参数启用 `/v1/chat/completions` ：

- `function_call` - auto （默认）、none 或要调用的特定函数
- `functions` - 模型可用函数的 JSON 描述

提供给模型的函数作为系统消息的一部分注入，并作为输入令牌计费/计数。

我们收到了几个社区请求，希望在将 SK 与支持此功能的 OpenAI 聊天完成模型一起使用时为此功能提供支持。

## 决策驱动因素

- 最大限度地减少对 OpenAI 特定功能的核心内核的更改
- 在请求中包含一长串函数描述的成本问题
- 自动执行模型返回的函数的安全性和成本问题

## 考虑的选项

- 支持通过聊天完成端点发送/接收功能，_并_修改界面
- 支持通过聊天完成端点发送/接收函数， _而无需_ 修改接口
- 围绕函数调用功能实现 Planner

## 决策结果

已选择选项：“支持通过聊天完成端点发送/接收功能 _，而无需_ 修改界面”

使用此选项，我们利用现有的请求设置对象将函数发送到模型。应用程序开发人员控制包含的函数，并负责验证和执行函数结果。

### 后果

- 很好，因为避免了对核心内核的破坏性更改
- 很好，因为 OpenAI 特定的功能包含在 OpenAI 连接器包中
- 很好，因为允许应用程序控制模型可用的功能（包括非 SK 功能）
- 很好，因为为将来与规划者集成提供了选项
- 中性，因为需要应用程序开发人员验证并执行生成的函数
- 不好，因为如何使用此功能和访问函数结果并不明显

## 选项的优缺点

### 支持发送/接收功能 _，但_ 修改了聊天补全界面

此选项将更新 `IChatCompletion` and `IChatResult` 接口，以公开用于提供和访问函数信息的参数/方法。

- 很好，因为为使用函数调用功能提供了清晰的路径
- 很好，因为允许应用程序控制模型可用的功能（包括非 SK 功能）
- 中性，因为需要应用程序开发人员验证并执行生成的函数
- 糟糕，因为引入了对核心内核抽象的重大更改
- 很糟糕，因为 OpenAI 特定的功能将包含在核心内核抽象中，并且需要被其他模型提供者忽略

### 围绕函数调用功能实现 Planner

编排外部函数调用符合 SK 的规划概念。使用这种方法，我们将实现一个规划器，它将获取函数调用结果并生成应用程序开发人员可以执行的计划（类似于 SK 的 ActionPlanner）。

- 很好，因为生成计划结果使应用程序开发人员可以轻松执行所选函数
- 不好，因为函数需要在内核中注册才能执行
- 不好，因为会造成何时使用哪个规划器的混淆

## 其他说明

对于自动调用 OpenAI 模型返回的函数（如果该函数已在内核中注册）的利弊，已经有很多讨论和争论。由于围绕此行为及其影响仍有许多悬而未决的问题，因此我们决定在初始实现中不包含此功能。我们将继续探索此选项，并可能在未来的更新中包括它。
